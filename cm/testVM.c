#include <avr/io.h>
#include "vm.h"
#include <avr/interrupt.h>
#include <util/delay.h>
#define MS_DELAY 1000

u8 data[] = { 0xE1, 0x00, 0x99, 0xD5, 0x00, 0xA1, 0xFF, 0x85, 0xD5, 0x00, 0xBD, 0xFF, 0x85, 0xD9,
0x80, 0xFF, 0x82, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x7F, 0xFF, 0x82, 0xD9, 0x7C, 0xFF, 0x81, 0xD9,
0x7F, 0xFF, 0x82, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x7F, 0xFF, 0x83, 0xD9, 0x7C, 0xFF, 0x81, 0xDB,
0x00, 0x0D, 0xEC, 0xAF, 0xFF, 0x86, 0xD9, 0x7C, 0xFF, 0x81, 0xDB, 0x00, 0x00, 0xAB, 0x8D, 0xFF,
0x86, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x30, 0xFF, 0x81, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x39, 0xFF,
0x81, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x61, 0xFF, 0x81, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x41, 0xFF,
0x81, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x0A, 0xFF, 0x82, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x0A, 0xFF,
0x82, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x0A, 0xFF, 0x82, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x0A, 0xFF,
0x82, 0xD9, 0x7C, 0xFF, 0x81, 0xD9, 0x0A, 0xFF, 0x82, 0xD9, 0x7C, 0xFF, 0x81, 0x90, 0xFF, 0x80,
0xD9, 0x7C, 0xFF, 0x81, 0x91, 0xFF, 0x80, 0xFF, 0x87, 0x04, 0x04, 0xE7, 0xFF, 0xFF, 0xE7, 0xFF,
0x67, 0x00, 0x54, 0x2E, 0x43, 0x00, 0x54, 0x65, 0x73, 0x74, 0x20, 0x30, 0x31, 0x3A, 0x20, 0x56,
0x61, 0x6C, 0x75, 0x65, 0x20, 0x54, 0x79, 0x70, 0x65, 0x73, 0x20, 0x28, 0x4C, 0x69, 0x74, 0x65,
0x72, 0x61, 0x6C, 0x73, 0x29, 0x0A, 0x00, 0x2D, 0x31, 0x32, 0x38, 0x7C, 0x31, 0x32, 0x37, 0x7C,
0x31, 0x32, 0x37, 0x7C, 0x31, 0x32, 0x37, 0x7C, 0x30, 0x30, 0x30, 0x44, 0x45, 0x43, 0x41, 0x46,
0x7C, 0x30, 0x30, 0x30, 0x30, 0x41, 0x42, 0x38, 0x44, 0x7C, 0x30, 0x7C, 0x39, 0x7C, 0x61, 0x7C,
0x41, 0x7C, 0x31, 0x30, 0x7C, 0x31, 0x30, 0x7C, 0x31, 0x30, 0x7C, 0x31, 0x30, 0x7C, 0x31, 0x30,
0x7C, 0x66, 0x61, 0x6C, 0x73, 0x65, 0x7C, 0x74, 0x72, 0x75, 0x65, 0x0A, 0x00 };
/*public*/  u8*    mem = data;

int main (void) {
    
Hal_Init();
    VM_Init(mem);
    VM_execute(mem);

    DDRB |= (1 << PB5);
    while(1) {
    // Set onboard LED for output. Just to see a blinking feedback from the Nano board.

        PORTB |= _BV(PORTB5);  // Turn the LED on.
        _delay_ms(MS_DELAY);
        PORTB &= ~_BV(PORTB5); // Turn the LED on.
        _delay_ms(MS_DELAY);
    }


}